<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search - Indiagram</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Grand+Hotel&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style> body { font-family: 'Inter', sans-serif; background: #fafafa; } .font-insta { font-family: 'Grand Hotel', cursive; } </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, query, where, getDocs, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyBIWFvOKLOpOFfik5YmsERR9pVLjs7tYTc", authDomain: "make-a-site.firebaseapp.com", projectId: "make-a-site", storageBucket: "make-a-site.firebasestorage.app", messagingSenderId: "1099071295300", appId: "1:1099071295300:web:c5e997a1591b9ffee55111" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        function Navbar() {
            return (
                <nav className="bg-white border-b h-16 flex items-center justify-between px-4 sticky top-0 z-50">
                    <h1 className="font-insta text-3xl cursor-pointer bg-clip-text text-transparent bg-gradient-to-r from-purple-600 to-orange-500" onClick={()=>window.location.href='home.html'}>Indiagram</h1>
                    <div className="flex gap-4 items-center">
                        <a href="home.html" className="material-icons-round text-3xl text-slate-600 hover:text-black">home</a>
                        <a href="search.html" className="material-icons-round text-3xl text-black">search</a>
                        <a href="message-list.html" className="material-icons-round text-3xl text-slate-600 hover:text-black">chat</a>
                        <a href="notifications.html" className="material-icons-round text-3xl text-slate-600 hover:text-black">favorite_border</a>
                        <a href="profile.html" className="material-icons-round text-3xl text-slate-600 hover:text-black">account_circle</a>
                    </div>
                </nav>
            );
        }

        function SearchPage() {
            const [queryText, setQueryText] = React.useState('');
            const [results, setResults] = React.useState([]);

            const handleSearch = async (e) => {
                const val = e.target.value;
                setQueryText(val);
                if(val.length > 2) {
                    // Simple search logic
                    const q = query(collection(db, "users"), limit(20));
                    const snap = await getDocs(q);
                    const filtered = snap.docs.map(d => d.data()).filter(u => 
                        u.username.toLowerCase().includes(val.toLowerCase()) || 
                        u.name.toLowerCase().includes(val.toLowerCase())
                    );
                    setResults(filtered);
                } else {
                    setResults([]);
                }
            };

            return (
                <div className="min-h-screen bg-white">
                    <Navbar />
                    <div className="max-w-md mx-auto p-4">
                        <div className="relative mb-6">
                            <input 
                                className="w-full bg-slate-100 p-3 pl-10 rounded-xl outline-none" 
                                placeholder="Search" 
                                value={queryText} 
                                onChange={handleSearch} 
                            />
                            <span className="material-icons-round absolute left-3 top-3 text-slate-400">search</span>
                        </div>

                        {results.map(u => (
                            <div key={u.uid} onClick={()=>window.location.href=`profile.html?uid=${u.uid}`} className="flex items-center gap-3 p-3 hover:bg-slate-50 cursor-pointer rounded-lg">
                                <img src={u.photoURL || "https://upload.wikimedia.org/wikipedia/commons/7/7c/Profile_avatar_placeholder_large.png"} className="w-12 h-12 rounded-full border object-cover" />
                                <div>
                                    <p className="font-bold text-sm flex items-center gap-1">
                                        {u.username} 
                                        {u.isVerified && <span className="material-icons-round text-blue-500 text-sm">verified</span>}
                                    </p>
                                    <p className="text-xs text-slate-500">{u.name}</p>
                                </div>
                            </div>
                        ))}
                        {queryText && results.length === 0 && <p className="text-center text-slate-400 mt-4">No users found.</p>}
                    </div>
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SearchPage />);
    </script>
</body>
</html>