<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notifications</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Grand+Hotel&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style> body { font-family: 'Inter', sans-serif; background: #fafafa; } .font-insta { font-family: 'Grand Hotel', cursive; } </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, query, where, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyBIWFvOKLOpOFfik5YmsERR9pVLjs7tYTc", authDomain: "make-a-site.firebaseapp.com", projectId: "make-a-site", storageBucket: "make-a-site.firebasestorage.app", messagingSenderId: "1099071295300", appId: "1:1099071295300:web:c5e997a1591b9ffee55111" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        function Navbar() {
            return (
                <nav className="bg-white border-b h-16 flex items-center justify-between px-4 sticky top-0 z-50">
                    <h1 className="font-insta text-3xl cursor-pointer bg-clip-text text-transparent bg-gradient-to-r from-purple-600 to-orange-500" onClick={()=>window.location.href='home.html'}>Indiagram</h1>
                    <div className="flex gap-4 items-center">
                        <a href="home.html" className="material-icons-round text-3xl text-slate-600 hover:text-black">home</a>
                        <a href="message-list.html" className="material-icons-round text-3xl text-slate-600 hover:text-black">chat</a>
                        <a href="notifications.html" className="material-icons-round text-3xl text-black">favorite</a>
                        <a href="profile.html" className="material-icons-round text-3xl text-slate-600 hover:text-black">account_circle</a>
                    </div>
                </nav>
            );
        }

        function NotificationsPage() {
            const [notifs, setNotifs] = React.useState([]);
            
            React.useEffect(() => {
                onAuthStateChanged(auth, u => {
                    if(!u) return window.location.href = "index.html";
                    const q = query(collection(db, "notifications"), where("to", "==", u.uid));
                    onSnapshot(q, snap => {
                        const data = snap.docs.map(d => d.data());
                        // sort manually as JS client-side if compound index missing
                        data.sort((a,b) => (b.timestamp?.seconds||0) - (a.timestamp?.seconds||0));
                        setNotifs(data);
                    });
                });
            }, []);

            return (
                <div className="min-h-screen bg-white">
                    <Navbar />
                    <div className="max-w-md mx-auto p-4">
                        <h2 className="font-bold text-xl mb-4">Notifications</h2>
                        {notifs.length === 0 && <p className="text-slate-500 text-center mt-10">No new notifications.</p>}
                        {notifs.map((n, i) => (
                            <div key={i} className="flex items-center gap-3 p-3 border-b hover:bg-slate-50">
                                <div className="w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center font-bold text-slate-500 uppercase">{n.fromName[0]}</div>
                                <div className="text-sm">
                                    <span className="font-bold">{n.fromName}</span>
                                    {n.type === 'like' && ' liked your post.'}
                                    {n.type === 'comment' && ` commented: "${n.content}"`}
                                    {n.type === 'follow' && ' started following you.'}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<NotificationsPage />);
    </script>
</body>
</html>